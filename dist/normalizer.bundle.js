!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return u}));var r,o,i,a,l=n(1);!function(e){e.FATAL="fatal",e.ERROR="error",e.WARN="warn",e.INFO="info",e.DEBUG="debug",e.TRACE="trace"}(r||(r={})),function(e){e.ASSETS="assets",e.ASSET_HISTORY="asset_history",e.ASSET_TYPES="asset_types",e.AREAS="areas",e.ACTIONS="actions",e.EVENT_TYPES="event_types",e.EVENTS="events",e.EVENT_HISTORY="event_history",e.RULES="rules"}(o||(o={})),function(e){e.OVERWRITE="overwrite",e.MERGE="merge"}(i||(i={})),function(e){e.NO="no",e.ALL="all",e.CUSTOM="custom"}(a||(a={}));var c={LOG_SETTING:r.DEBUG,CUSTOM_CONFIGS:{},ASSET_HISTORY_CONFIG:{STANDARD_KEYS_TO_STORE:["location_x","location_y","location_z"],CUSTOM_DATA_KEYS_TO_STORE:[],LOG_SETTING:r.DEBUG,STANDARD_KEY_STORAGE_SETTING:a.CUSTOM,CUSTOM_DATA_KEY_STORAGE_SETTING:a.ALL,LOG_SERVICE_NAME:"AssetHistoryServiceNameUnset"},NORMALIZER_PUB_CONFIG:{locationConfig:{topicFn:l.a.DBUpdateAssetLocation,keysToPublish:["id","location_x","location_y","location_z","location_unit","location_type","latitude","longitude","last_updated","last_location_updated"]},statusConfig:{topicFn:l.a.DBUpdateAssetStatus,keysToPublish:["custom_data","id","type"]},historyConfig:{topicFn:l.a.AssetHistory,keysToPublish:["id","location_x","location_y","location_z","location_unit","location_type","latitude","longitude","last_updated","last_location_updated","custom_data","type"]},rulesConfig:{topicFn:l.a.RulesAssetLocation,keysToPublish:["id","location_x","location_y","location_z","location_unit","location_type","latitude","longitude","last_updated","last_location_updated","custom_data","type"]}},UPDATE_ASSET_LOCATION_OPTIONS:{KEYS_TO_UPDATE:["location_x","location_y","location_z","location_unit","location_type","latitude","longitude","last_updated","last_location_updated"],CREATE_NEW_ASSET_IF_MISSING:!1,LOG_SETTING:r.DEBUG,LOG_SERVICE_NAME:"AssetLocationServiceNameUnset"},UPDATE_ASSET_STATUS_OPTIONS:{UPDATE_METHOD:i.MERGE,LOG_SETTING:r.DEBUG,LOG_SERVICE_NAME:"AssetStatusServiceNameUnset"}};var u=c},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var o={AssetLocation:function(e){return"_monitor/_asset/".concat(e,"/location")},RulesAssetLocation:function(e){return"_rules/_monitor/_asset/".concat(e,"/location")},DBUpdateAssetLocation:function(e){return"_dbupdate/_monitor/_asset/".concat(e,"/location")},HistoryAssetLocation:function(e){return"_history/_monitor/_asset/".concat(e,"/location")},AssetHistory:function(e){return"_history/_monitor/_asset/".concat(e,"/location")},DBUpdateAssetStatus:function(e){return"_dbupdate/_monitor/_asset/".concat(e,"/status")},AreaLocationEvent:function(e){return"_monitor/_area/".concat(e,"/location")},ListenAllAssetsLocation:function(){return"_monitor/_asset/+/location"},ListenAllAssetsStatus:function(){return"_monitor/_asset/+/status"}};function i(e){return e&&"object"===r(e)?e.stack?e.stack:e.message?e.message:JSON.stringify(e):e}},function(e,t,n){"use strict";function r(e){var t=ClearBlade.Messaging();return new Promise((function(n,r){t.subscribe(e,(function(e,t){e?r(new Error("Error with subscribing: "+JSON.stringify(t))):n(t)}))}))}Object.defineProperty(t,"__esModule",{value:!0}),n(6),t.subscriber=r,t.bulkSubscriber=function(e){return new Promise((function(t,n){Promise.all(e.map((function(e){r(e)}))).then((function(){t()})).catch((function(e){log("Subscription error: "+e.message),n(new Error(e))})),Promise.runQueue()}))}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.length>0?"".concat(t.map((function(e){return"object"===i(e)?JSON.stringify(e):e})).join(" ")):""}function l(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return a.apply(void 0,[e.name].concat(n))}n.d(t,"a",(function(){return u}));var c={name:"NameNotSet",logSetting:n(0).a.LOG_SETTING},u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,n=t.name,r=void 0===n?c.name:n,i=t.logSetting,a=void 0===i?c.logSetting:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"name",void 0),o(this,"logSetting",void 0),o(this,"levels",{trace:1,debug:2,info:3,warn:4,error:5,fatal:6}),this.name=r,this.logSetting=a}var t,n,i;return t=e,(n=[{key:"levelToInt",value:function(e){return e.toLowerCase()in this.levels?this.levels[e.toLowerCase()]:99}},{key:"publishLog",value:function(e){for(var t=ClearBlade.Messaging(),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=l({name:this.name},r),a=this.levelToInt(e),c=this.levelToInt(this.logSetting||"");a<c||t.publish(e,i)}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"publisher",(function(){return l})),n.d(t,"bulkPublisher",(function(){return c})),n.d(t,"normalizer",(function(){return u})),n.d(t,"api",(function(){return s}));var r=n(3),o=n(0),i=n(1),a=n(2);n.d(t,"subscriber",(function(){return a.subscriber})),n.d(t,"bulkSubscriber",(function(){return a.bulkSubscriber}));n(7);function l(e,t){for(var n=ClearBlade.Messaging(),r=function(r,o){var i=e[r].id,a=t.topicFn(i),l={};t.keysToPublish.forEach((function(t){l[t]=e[r][t]})),(void 0===t.shouldPublishAsset||t.shouldPublishAsset(l))&&n.publish(a,JSON.stringify(l))},o=0,i=e.length;o<i;o++)r(o)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.a.NORMALIZER_PUB_CONFIG;Object.keys(t).forEach((function(n){l(e,t[n])}))}function u(e){var t=e.messageParser,n=e.normalizerPubConfig||o.a.NORMALIZER_PUB_CONFIG,l=e.logServiceName||"Normalizer",u=e.logSetting||o.b.DEBUG,s=e.topics[0],f=e.req.service_instance_id,d=ClearBlade.Messaging(),h=new r.a({name:l,logSetting:u});h.publishLog(o.b.DEBUG,"Normalizer SERVICE_INSTANCE_ID:: "+f);for(var v=[],y=0,p=e.topics.length;y<p;y++)v.push(Object(a.subscriber)(e.topics[y]));function b(e){h.publishLog(o.b.ERROR,"Failed ",Object(i.b)(e))}function m(r,o,i){r&&e.resp.error("HandleMessage error inside Normalizer. Service was probably killed while waiting for messages. ".concat(JSON.stringify({err:r,msg:o,topic:i}))),t(r,o,i).then((function(e){c(e,n)})).catch(b),Promise.runQueue()}Promise.all(v).then((function(){for(h.publishLog(o.b.INFO,"Subscribed to Shared Topics. Starting Loop.");;)d.waitForMessage([s],m)})).catch(b),Promise.runQueue()}e.normalizer=u;var s={default:u,publisher:l}}.call(this,n(5))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){!function(){if("undefined"==typeof Promise){var e=!0,t=null,n=null,r="object"==typeof Duktape&&Duktape.compact||function(e){return e},o=function(){},i="function"==typeof Symbol,a=i?Symbol("promise"):"__PromiseInstance__",l=function(e){if(!new.target)throw new TypeError("Promise must be called as a constructor");if("function"!=typeof e)throw new TypeError("executor must be callable");d(this,a,!0,""),d(this,"state",void 0),d(this,"value",void 0),d(this,"fulfillReactions",[]),d(this,"rejectReactions",[]),d(this,"isHandled",!1),r(this);var t=b(this);try{e(t.resolve,t.reject)}catch(e){t.reject(e)}},c=l.prototype;d(l,"prototype",c,""),d(l,"potentiallyUnhandled",[],"");var u=function(e){return this.then.call(this,void 0,e)};d(u,"name","catch","c");var s=function(e){return new this((function(t,n){t(e())}))};d(s,"name","try","c"),function(){d(this,"Promise",l),d(l,"resolve",_),d(l,"reject",g),d(l,"all",S),d(l,"race",E),d(l,"try",s),d(l,"isPolyfill",!0),d(c,"then",j),d(c,"catch",u),i&&d(c,Symbol.toStringTag,"Promise","c"),d(l,"runQueue",(function(){do{for(;m(););T()}while(t||0!==l.potentiallyUnhandled.length)})),d(l,"unhandledRejection",o),r(this),r(l),r(c)}()}function f(e){Object.setPrototypeOf(e,null),r(e),t?(n.next=e,r(n),n=e):(t=e,n=e)}function d(e,t,n,r){void 0===r&&(r="wc"),Object.defineProperty(e,t,{value:n,writable:r.indexOf("w")>=0,enumerable:r.indexOf("e")>=0,configurable:r.indexOf("c")>=0})}function h(e){return null!==e&&"object"==typeof e&&a in e}function v(e){try{l.unhandledRejection(e)}catch(e){}}function y(e,t){try{"reject"===t?(v({promise:e,event:"rawReject",reason:e.value}),d(e,"unhandled",1),l.potentiallyUnhandled.push(e)):"handle"===t&&(v({promise:e,event:"rawHandle",reason:e.value}),2===e.unhandled?(d(e,"unhandled",3),l.potentiallyUnhandled.push(e)):delete e.unhandled)}catch(e){}}function p(e,t){if(void 0===e.state){e.state=!1,e.value=t;var n=e.rejectReactions;delete e.fulfillReactions,delete e.rejectReactions,r(e),n.forEach((function(e){e.value=t,e.handler||(e.rejected=!0),f(e)})),e.isHandled||y(e,"reject")}}function b(t){var n=!1;return{resolve:function(o){if(new.target)throw new TypeError("resolve is not constructable");if(!n&&(n=!0,void 0===t.state)){if(o===t)return p(t,new TypeError("self resolution"));try{var i=null!==o&&"object"==typeof o&&o.then;if("function"==typeof i){var a=b(t);return f(e?{thenable:o,then:i,target:t}:{thenable:o,then:i,resolve:a.resolve,reject:a.reject})}return function(e,t){if(void 0===e.state){e.state=!0,e.value=t;var n=e.fulfillReactions;delete e.fulfillReactions,delete e.rejectReactions,r(e),n.forEach((function(e){e.value=t,f(e)}))}}(t,o)}catch(e){return p(t,e)}}},reject:function(e){if(new.target)throw new TypeError("reject is not constructable");n||(n=!0,void 0===t.state&&p(t,e))}}}function m(){var e,r,o=((e=t)&&((t=e.next)||(n=null)),e);if(!o)return!1;if(o.then){o.target&&(r=b(o.target));try{r?o.then.call(o.thenable,r.resolve,r.reject):o.then.call(o.thenable,o.resolve,o.reject)}catch(e){r?r.reject.call(void 0,e):o.reject.call(void 0,e)}}else try{if(void 0===o.handler)return r=b(o.target),(r=o.rejected?r.reject:r.resolve).call(void 0,o.value),!0;if("Identity"===o.handler)res=o.value;else{if("Thrower"===o.handler)throw o.value;res=o.handler.call(void 0,o.value)}o.target?b(o.target).resolve.call(void 0,res):o.resolve.call(void 0,res)}catch(e){o.target?b(o.target).reject.call(void 0,e):o.reject.call(void 0,e)}return!0}function _(e){return h(e)&&e.constructor===this?e:new Promise((function(t,n){t(e)}))}function g(e){return new Promise((function(t,n){n(e)}))}function S(e){if(!Array.isArray(e))throw new TypeError("non-array all() argument not supported");var t,n,r=new Promise((function(e,r){t=e,n=r})),o=[],i=0,a=1;return e.forEach((function(e){var r=Promise.resolve(e),l=function e(n){var r=e;r.alreadyCalled||(r.alreadyCalled=!0,o[r.index]=n,0==--a&&t.call(void 0,o))};l.index=i++,a++,r.then(l,n)})),0==--a&&t.call(void 0,o),r}function E(t){if(!Array.isArray(t))throw new TypeError("non-array race() argument not supported");var n,r,o=new Promise((function(e,t){n=e,r=t}));return t.forEach((function(t){var i=Promise.resolve(t),a=i.then;a===j&&e?function(e,t){void 0===e.state?(e.fulfillReactions.push({target:t}),e.rejectReactions.push({target:t})):e.state?f({target:t,value:e.value}):(e.isHandled||y(e,"handle"),f({target:t,value:e.value,rejected:!0}));e.isHandled=!0}(i,o):a.call(i,n,r)})),o}function j(t,n){var r,o;!function(e){if(!h(e))throw new TypeError("Promise required")}(this);var i=new Promise((function(e,t){r=e,o=t})),a=e;return"function"!=typeof t&&(t="Identity"),"function"!=typeof n&&(n="Thrower"),void 0===this.state?a?(this.fulfillReactions.push({handler:t,target:i}),this.rejectReactions.push({handler:n,target:i})):(this.fulfillReactions.push({handler:t,resolve:r,reject:o}),this.rejectReactions.push({handler:n,resolve:r,reject:o})):this.state?f(a?{handler:t,target:i,value:this.value}:{handler:t,resolve:r,reject:o,value:this.value}):(this.isHandled||y(this,"handle"),f(a?{handler:n,target:i,value:this.value}:{handler:n,resolve:r,reject:o,value:this.value})),this.isHandled=!0,i}function T(){var e;for(e=0;e<l.potentiallyUnhandled.length;e++){var t=l.potentiallyUnhandled[e];l.potentiallyUnhandled[e]=null,1===t.unhandled?(v({promise:t,event:"reject",reason:t.value}),d(t,"unhandled",2)):3===t.unhandled&&(v({promise:t,event:"handle",reason:t.value}),delete t.unhandled)}return l.potentiallyUnhandled.length=0,e>0}}()},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){if("undefined"==typeof Promise){var e=!0,t=null,r=null,o="object"===("undefined"==typeof Duktape?"undefined":n(Duktape))&&Duktape.compact||function(e){return e},i=function(){},a="function"==typeof Symbol,l=a?Symbol("promise"):"__PromiseInstance__",c=function e(t){if(!(this instanceof e?this.constructor:void 0))throw new TypeError("Promise must be called as a constructor");if("function"!=typeof t)throw new TypeError("executor must be callable");h(this,l,!0,""),h(this,"state",void 0),h(this,"value",void 0),h(this,"fulfillReactions",[]),h(this,"rejectReactions",[]),h(this,"isHandled",!1),o(this);var n=m(this);try{t(n.resolve,n.reject)}catch(e){n.reject(e)}},u=c.prototype;h(c,"prototype",u,""),h(c,"potentiallyUnhandled",[],"");var s=function(e){return this.then.call(this,void 0,e)};h(s,"name","catch","c");var f=function(e){return new this((function(t,n){t(e())}))};h(f,"name","try","c"),function(){h(this,"Promise",c),h(c,"resolve",g),h(c,"reject",S),h(c,"all",E),h(c,"race",j),h(c,"try",f),h(c,"isPolyfill",!0),h(u,"then",T),h(u,"catch",s),a&&h(u,Symbol.toStringTag,"Promise","c"),h(c,"runQueue",(function(){do{for(;_(););w()}while(t||0!==c.potentiallyUnhandled.length)})),h(c,"unhandledRejection",i),o(this),o(c),o(u)}()}function d(e){Object.setPrototypeOf(e,null),o(e),t?(r.next=e,o(r),r=e):(t=e,r=e)}function h(e,t,n,r){void 0===r&&(r="wc"),Object.defineProperty(e,t,{value:n,writable:r.indexOf("w")>=0,enumerable:r.indexOf("e")>=0,configurable:r.indexOf("c")>=0})}function v(e){return null!==e&&"object"===n(e)&&l in e}function y(e){try{c.unhandledRejection(e)}catch(e){}}function p(e,t){try{"reject"===t?(y({promise:e,event:"rawReject",reason:e.value}),h(e,"unhandled",1),c.potentiallyUnhandled.push(e)):"handle"===t&&(y({promise:e,event:"rawHandle",reason:e.value}),2===e.unhandled?(h(e,"unhandled",3),c.potentiallyUnhandled.push(e)):delete e.unhandled)}catch(e){}}function b(e,t){if(void 0===e.state){e.state=!1,e.value=t;var n=e.rejectReactions;delete e.fulfillReactions,delete e.rejectReactions,o(e),n.forEach((function(e){e.value=t,e.handler||(e.rejected=!0),d(e)})),e.isHandled||p(e,"reject")}}function m(t){var r=!1;return{resolve:function i(a){if(this instanceof i?this.constructor:void 0)throw new TypeError("resolve is not constructable");if(!r&&(r=!0,void 0===t.state)){if(a===t)return b(t,new TypeError("self resolution"));try{var l=null!==a&&"object"===n(a)&&a.then;if("function"==typeof l){var c=m(t);return d(e?{thenable:a,then:l,target:t}:{thenable:a,then:l,resolve:c.resolve,reject:c.reject})}return function(e,t){if(void 0===e.state){e.state=!0,e.value=t;var n=e.fulfillReactions;delete e.fulfillReactions,delete e.rejectReactions,o(e),n.forEach((function(e){e.value=t,d(e)}))}}(t,a)}catch(e){return b(t,e)}}},reject:function e(n){if(this instanceof e?this.constructor:void 0)throw new TypeError("reject is not constructable");r||(r=!0,void 0===t.state&&b(t,n))}}}function _(){var e,n,o=((e=t)&&((t=e.next)||(r=null)),e);if(!o)return!1;if(o.then){o.target&&(n=m(o.target));try{n?o.then.call(o.thenable,n.resolve,n.reject):o.then.call(o.thenable,o.resolve,o.reject)}catch(e){n?n.reject.call(void 0,e):o.reject.call(void 0,e)}}else try{if(void 0===o.handler)return n=m(o.target),(n=o.rejected?n.reject:n.resolve).call(void 0,o.value),!0;if("Identity"===o.handler)res=o.value;else{if("Thrower"===o.handler)throw o.value;res=o.handler.call(void 0,o.value)}o.target?m(o.target).resolve.call(void 0,res):o.resolve.call(void 0,res)}catch(e){o.target?m(o.target).reject.call(void 0,e):o.reject.call(void 0,e)}return!0}function g(e){return v(e)&&e.constructor===this?e:new Promise((function(t,n){t(e)}))}function S(e){return new Promise((function(t,n){n(e)}))}function E(e){if(!Array.isArray(e))throw new TypeError("non-array all() argument not supported");var t,n,r=new Promise((function(e,r){t=e,n=r})),o=[],i=0,a=1;return e.forEach((function(e){var r=Promise.resolve(e),l=function e(n){var r=e;r.alreadyCalled||(r.alreadyCalled=!0,o[r.index]=n,0==--a&&t.call(void 0,o))};l.index=i++,a++,r.then(l,n)})),0==--a&&t.call(void 0,o),r}function j(t){if(!Array.isArray(t))throw new TypeError("non-array race() argument not supported");var n,r,o=new Promise((function(e,t){n=e,r=t}));return t.forEach((function(t){var i=Promise.resolve(t),a=i.then;a===T&&e?function(e,t){void 0===e.state?(e.fulfillReactions.push({target:t}),e.rejectReactions.push({target:t})):e.state?d({target:t,value:e.value}):(e.isHandled||p(e,"handle"),d({target:t,value:e.value,rejected:!0}));e.isHandled=!0}(i,o):a.call(i,n,r)})),o}function T(t,n){var r,o;!function(e){if(!v(e))throw new TypeError("Promise required")}(this);var i=new Promise((function(e,t){r=e,o=t})),a=e;return"function"!=typeof t&&(t="Identity"),"function"!=typeof n&&(n="Thrower"),void 0===this.state?a?(this.fulfillReactions.push({handler:t,target:i}),this.rejectReactions.push({handler:n,target:i})):(this.fulfillReactions.push({handler:t,resolve:r,reject:o}),this.rejectReactions.push({handler:n,resolve:r,reject:o})):this.state?d(a?{handler:t,target:i,value:this.value}:{handler:t,resolve:r,reject:o,value:this.value}):(this.isHandled||p(this,"handle"),d(a?{handler:n,target:i,value:this.value}:{handler:n,resolve:r,reject:o,value:this.value})),this.isHandled=!0,i}function w(){var e;for(e=0;e<c.potentiallyUnhandled.length;e++){var t=c.potentiallyUnhandled[e];c.potentiallyUnhandled[e]=null,1===t.unhandled?(y({promise:t,event:"reject",reason:t.value}),h(t,"unhandled",2)):3===t.unhandled&&(y({promise:t,event:"handle",reason:t.value}),delete t.unhandled)}return c.potentiallyUnhandled.length=0,e>0}}()}]);